import{H as t,a as e,i as n}from"./header-BTcOR6oH.js";const r=document.querySelector(".site-header");r&&new t(r,e);const a=new URLSearchParams(window.location.search),o=a.get("book"),s=a.get("chapter");function c(t,e,n){const r=document.getElementById("breadcrumb-book"),a=document.getElementById("breadcrumb-chapter");r&&(r.textContent=t.title[n],r.href=`book.html?id=${t.slug}`),a&&(a.textContent=e.title[n])}async function i(t,r,a){const o=document.getElementById("chapter-content");if(o)try{o.innerHTML=`\n      <div class="loading" role="status" aria-live="polite">\n        <span class="spinner" aria-hidden="true"></span>\n        <span>${n.t("loading")}</span>\n      </div>\n    `;let s=await e.services.books.getChapterContent(r.contentFile);const c=(new DOMParser).parseFromString(s,"text/html");c.querySelectorAll("img").forEach(e=>{const n=e.getAttribute("src");!n||n.startsWith("http")||n.startsWith("/")||n.startsWith("content/")||e.setAttribute("src",`content/${t.id}/${n}`)});c.querySelectorAll('link[rel="stylesheet"]').forEach(e=>{const n=e.getAttribute("href");if(n&&!n.startsWith("http")&&!n.startsWith("/")){const e=`content/${t.id}/${n}`;if(!document.querySelector(`link[href*="${e}"]`)){const t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.head.appendChild(t)}}});c.querySelectorAll("a").forEach(e=>{const n=e.getAttribute("href");if(n&&!n.startsWith("http")&&!n.startsWith("#")&&n.endsWith(".html")){const r=n.replace(".html","");t.chapters.find(t=>t.slug===r||t.id===r)?e.setAttribute("href",`chapter.html?book=${t.slug}&chapter=${r}`):"index"===r||"book"===r?e.setAttribute("href",`book.html?id=${t.slug}`):["purchase","contact","about"].includes(r)&&e.setAttribute("href",`${r}.html`)}});let i=c.querySelector(".chapter-content")||c.querySelector("#contenu")||c.querySelector("article")||c.querySelector("main")||c.body;i.querySelectorAll("script").forEach(t=>t.remove());i.querySelectorAll("#fleches, #entete, .nav, #header, #menus").forEach(t=>t.remove()),s=i.innerHTML;const l=e.services.books.getPreviousChapter(t,r.slug),d=e.services.books.getNextChapter(t,r.slug);o.innerHTML=`\n      <div class="chapter-container">\n        <header class="chapter-header">\n          <h1 class="chapter-title">${h(r.title[a])}</h1>\n          <p class="chapter-meta">${h(t.title[a])} - ${h(t.author)}</p>\n        </header>\n\n        <article class="chapter-content">\n          ${s}\n        </article>\n\n        <nav class="chapter-navigation" aria-label="${n.t("chapterNavigation")}">\n          ${l?`\n            <a href="chapter.html?book=${t.slug}&chapter=${l.slug}" class="nav-btn nav-btn-prev">\n              <span aria-hidden="true">${"he"===a?"→":"←"}</span>\n              <span>${n.t("previousChapter")}</span>\n            </a>\n          `:"<div></div>"}\n\n          <a href="book.html?id=${t.slug}" class="nav-btn nav-btn-toc">\n            ${n.t("tableOfContents")}\n          </a>\n\n          ${d?`\n            <a href="chapter.html?book=${t.slug}&chapter=${d.slug}" class="nav-btn nav-btn-next">\n              <span>${n.t("nextChapter")}</span>\n              <span aria-hidden="true">${"he"===a?"←":"→"}</span>\n            </a>\n          `:"<div></div>"}\n        </nav>\n      </div>\n    `}catch(s){console.error("Error rendering chapter:",s),o.innerHTML=`\n      <div style="text-align: center; padding: var(--space-3xl); color: var(--color-error);">\n        <h2>${n.t("errors.loadFailed")}</h2>\n        <p style="margin-top: var(--space-md);">\n          <a href="book.html?id=${t.slug}" class="btn-primary">${n.t("backToBook")}</a>\n        </p>\n      </div>\n    `}}function l(t){const e=document.getElementById("chapter-content");e&&(e.innerHTML=`\n      <div style="text-align: center; padding: var(--space-3xl); color: var(--color-error);">\n        <h2>${t}</h2>\n        <p style="margin-top: var(--space-md);">\n          <a href="index.html" class="btn-primary">${n.t("home")}</a>\n        </p>\n      </div>\n    `)}function h(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}o&&s?async function(t,r){try{const n=await e.getBook(t),a=e.services.books.getChapter(n,r);if(!a)throw new Error("Chapter not found");const o=e.getState().currentLanguage;document.title=`${a.title[o]} - ${n.title[o]} - ספרי גאולה`,c(n,a,o),await i(n,a,o),document.addEventListener("app:languageChange",async()=>{const t=e.getState().currentLanguage;document.title=`${a.title[t]} - ${n.title[t]} - ספרי גאולה`,c(n,a,t),await i(n,a,t)})}catch(a){console.error("Error loading chapter:",a),l(n.t("errors.chapterNotFound"))}}(o,s):l("לא צוינו פרמטרים נדרשים");
