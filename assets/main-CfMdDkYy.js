import{i as e,H as t,a as n}from"./header-BTcOR6oH.js";function o(e=document){if("IntersectionObserver"in window){const t=new IntersectionObserver((e,n)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target,o=n.dataset.src;if(o){const e=new Image;e.onload=()=>{n.src=o,n.removeAttribute("data-src"),n.classList.add("loaded")},e.onerror=()=>{console.error(`Failed to load image: ${o}`),n.alt=n.alt+" (failed to load)"},e.src=o,t.unobserve(n)}}})},{rootMargin:"50px 0px",threshold:.01});e.querySelectorAll("img[data-src]").forEach(e=>{t.observe(e)})}else{e.querySelectorAll("img[data-src]").forEach(e=>{e.src=e.dataset.src,e.removeAttribute("data-src")})}}class r{constructor(e,t){this.element=e,this.app=t,this.gridElement=e.querySelector("#books-grid"),this.featuredContainer=document.querySelector("#featured-book-container"),this.books=[],this.init()}async init(){document.addEventListener("app:stateChange",e=>{const{books:t,isLoading:n}=e.detail.newState;t&&t.length>0&&(this.books=t,this.render()),!1!==n||t&&0!==t.length||this.renderEmpty()}),document.addEventListener("app:languageChange",()=>{this.books.length>0&&this.render()});const e=this.app.getState();e.books&&e.books.length>0&&(this.books=e.books,this.render())}render(){this.renderFeaturedBook(),this.renderBookGrid(),requestAnimationFrame(()=>{o(this.element),this.featuredContainer&&o(this.featuredContainer)})}renderFeaturedBook(){var t;if(!this.featuredContainer)return;const n=this.books.filter(e=>e.featured);if(0===n.length)return void(this.featuredContainer.innerHTML="");const o=n[0],r=this.app.getState().currentLanguage;this.featuredContainer.innerHTML=`\n      <div class="featured-book-image">\n        <img\n          data-src="${o.cover||(null==(t=o.media)?void 0:t.cover)||"images/books/"+o.slug+"/cover.png"}"\n          alt="${this.escapeHtml(o.title[r])}"\n          loading="lazy"\n          width="400"\n          height="600"\n          style="width: 100%; max-width: 400px; border-radius: var(--radius-lg); box-shadow: var(--shadow-xl);"\n        >\n      </div>\n      <div class="featured-book-details">\n        <h3 style="font-size: var(--font-size-2xl); margin-bottom: var(--space-md);">\n          ${this.escapeHtml(o.title[r])}\n        </h3>\n        <p style="font-size: var(--font-size-md); color: var(--color-text-medium); margin-bottom: var(--space-sm);">\n          <strong>${e.t("author")}:</strong> ${this.escapeHtml(o.author)}\n        </p>\n        ${o.quote&&o.quote[r]?`\n          <blockquote style="padding-inline-start: var(--space-md); border-inline-start: 4px solid var(--color-primary); margin: var(--space-lg) 0; font-style: italic; color: var(--color-text-medium);">\n            ${this.escapeHtml(o.quote[r])}\n          </blockquote>\n        `:""}\n        ${o.description&&o.description[r]?`\n          <p style="line-height: var(--line-height-relaxed); color: var(--color-text-medium); margin-bottom: var(--space-lg);">\n            ${this.escapeHtml(o.description[r])}\n          </p>\n        `:""}\n        <div style="display: flex; gap: var(--space-lg); flex-wrap: wrap; margin-bottom: var(--space-lg);">\n          ${o.pages?`\n            <div>\n              <div style="font-size: var(--font-size-sm); color: var(--color-text-light); text-transform: uppercase;">${e.t("pages")}</div>\n              <div style="font-size: var(--font-size-lg); font-weight: var(--font-weight-semibold);">${o.pages}</div>\n            </div>\n          `:""}\n          ${o.price?`\n            <div>\n              <div style="font-size: var(--font-size-sm); color: var(--color-text-light); text-transform: uppercase;">${e.t("price")}</div>\n              <div style="font-size: var(--font-size-lg); font-weight: var(--font-weight-semibold); color: var(--color-primary);">\n                ${o.price} ${o.currency||"₪"}\n              </div>\n            </div>\n          `:""}\n        </div>\n        <a href="book.html?id=${o.slug}" class="btn-primary" style="display: inline-block;">\n          ${e.t("readMore")}\n        </a>\n      </div>\n    `}renderBookGrid(){if(!this.gridElement)return;if(0===this.books.length)return void this.renderEmpty();const e=this.app.getState().currentLanguage;this.gridElement.innerHTML=this.books.map(t=>this.renderBookCard(t,e)).join("")}renderBookCard(t,n){var o;return`\n      <article class="book-card" role="listitem">\n        <div class="book-card__image">\n          <img\n            data-src="${t.cover||(null==(o=t.media)?void 0:o.cover)||`images/books/${t.slug}/cover.png`}"\n            alt="${this.escapeHtml(t.title[n])}"\n            loading="lazy"\n            width="300"\n            height="450"\n          >\n          ${"coming_soon"===t.status?`\n            <span class="book-card__badge">${e.t("comingSoon")}</span>\n          `:t.featured?`\n            <span class="book-card__badge">${e.t("featuredBook")}</span>\n          `:""}\n        </div>\n        <div class="book-card__content">\n          <h3 class="book-card__title">${this.escapeHtml(t.title[n])}</h3>\n          <p class="book-card__author">${this.escapeHtml(t.author)}</p>\n          ${t.description&&t.description[n]?`\n            <p class="book-card__description">${this.escapeHtml(t.description[n])}</p>\n          `:""}\n          <div class="book-card__footer">\n            ${t.price?`\n              <span class="book-card__price">${t.price} ${t.currency||"₪"}</span>\n            `:""}\n            <a\n              href="book.html?id=${t.slug}"\n              class="btn-secondary btn-sm"\n              aria-label="${e.t("viewDetails")} - ${this.escapeHtml(t.title[n])}"\n            >\n              ${e.t("moreDetails")}\n            </a>\n          </div>\n        </div>\n      </article>\n    `}renderEmpty(){this.gridElement&&(this.gridElement.innerHTML=`\n        <p style="text-align: center; color: var(--color-text-medium); padding: var(--space-xl);">\n          ${e.t("noBooksAvailable")}\n        </p>\n      `)}escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}}const i=document.querySelector(".site-header");i&&new t(i,n);const a=window.location.pathname;if("/"===a||"/index.html"===a||a.endsWith("/Geoulah-Books/")){const e=document.querySelector(".books-catalog");e&&new r(e,n)}console.log("Geoulah Books initialized");
