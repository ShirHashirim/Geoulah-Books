!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class e{constructor(){this.baseUrl="/Geoulah-Books/data",this.cache=new Map,this.cacheExpiry=3e5}async getAll(){const e="all-books";if(this.cache.has(e)){const t=this.cache.get(e);if(Date.now()-t.timestamp<this.cacheExpiry)return t.data}try{const t=await fetch(`${this.baseUrl}/books.json`);if(!t.ok)throw new Error(`Failed to fetch books: ${t.statusText}`);const r=(await t.json()).books||[];return this.cache.set(e,{data:r,timestamp:Date.now()}),r}catch(t){if(console.error("Error fetching books:",t),this.cache.has(e))return console.warn("Using expired cache data"),this.cache.get(e).data;throw t}}async getBySlug(e){const t=(await this.getAll()).find(t=>t.slug===e||t.id===e);if(!t)throw new Error(`Book not found: ${e}`);return t}async getById(e){return this.getBySlug(e)}async getFeatured(){return(await this.getAll()).filter(e=>!0===e.featured)}async getByStatus(e){return(await this.getAll()).filter(t=>t.status===e)}async getChapterContent(e){const t=`chapter-${e}`;if(this.cache.has(t)){const e=this.cache.get(t);if(Date.now()-e.timestamp<this.cacheExpiry)return e.data}try{const r=await fetch(e);if(!r.ok)throw new Error(`Chapter not found: ${e}`);const a=await r.text();return this.cache.set(t,{data:a,timestamp:Date.now()}),a}catch(r){if(console.error("Error loading chapter:",r),this.cache.has(t))return console.warn("Using expired cache for chapter"),this.cache.get(t).data;throw r}}getChapter(e,t){return e&&e.chapters?e.chapters.find(e=>e.slug===t||e.id===t):null}getNextChapter(e,t){if(!e||!e.chapters)return null;const r=e.chapters.findIndex(e=>e.slug===t||e.id===t);return-1===r||r===e.chapters.length-1?null:e.chapters[r+1]}getPreviousChapter(e,t){if(!e||!e.chapters)return null;const r=e.chapters.findIndex(e=>e.slug===t||e.id===t);return r<=0?null:e.chapters[r-1]}clearCache(){this.cache.clear()}removeCacheItem(e){this.cache.delete(e)}getCacheStats(){const e=Array.from(this.cache.entries()),t=Date.now();return{totalItems:this.cache.size,validItems:e.filter(([,e])=>t-e.timestamp<this.cacheExpiry).length,expiredItems:e.filter(([,e])=>t-e.timestamp>=this.cacheExpiry).length}}async preload(){try{await this.getAll(),console.log("Book data preloaded successfully")}catch(e){console.error("Failed to preload book data:",e)}}}class t{constructor(e="geoulah_"){this.prefix=e,this.isAvailable=this.checkAvailability()}checkAvailability(){try{const e="__localStorage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return console.warn("localStorage is not available:",e),!1}}getKey(e){return`${this.prefix}${e}`}get(e,t=null){if(!this.isAvailable)return t;try{const r=localStorage.getItem(this.getKey(e));return null===r?t:JSON.parse(r)}catch(r){return console.error(`Error reading from localStorage (key: ${e}):`,r),t}}set(e,t){if(!this.isAvailable)return!1;try{const r=JSON.stringify(t);return localStorage.setItem(this.getKey(e),r),!0}catch(r){return console.error(`Error writing to localStorage (key: ${e}):`,r),!1}}remove(e){if(!this.isAvailable)return!1;try{return localStorage.removeItem(this.getKey(e)),!0}catch(t){return console.error(`Error removing from localStorage (key: ${e}):`,t),!1}}clear(){if(!this.isAvailable)return!1;try{const e=Object.keys(localStorage);return e.filter(e=>e.startsWith(this.prefix)).forEach(e=>localStorage.removeItem(e)),!0}catch(e){return console.error("Error clearing localStorage:",e),!1}}has(e){return!!this.isAvailable&&null!==localStorage.getItem(this.getKey(e))}keys(){if(!this.isAvailable)return[];try{return Object.keys(localStorage).filter(e=>e.startsWith(this.prefix)).map(e=>e.substring(this.prefix.length))}catch(e){return console.error("Error getting localStorage keys:",e),[]}}getSize(){if(!this.isAvailable)return 0;try{const e=Object.keys(localStorage);let t=0;return e.forEach(e=>{if(e.startsWith(this.prefix)){const r=localStorage.getItem(e);t+=e.length+(r?r.length:0)}}),t}catch(e){return console.error("Error calculating localStorage size:",e),0}}}new t;const r=new class{constructor(){this.currentLanguage="he",this.translations={he:{home:"בית",books:"ספרים",about:"אודות",contact:"צור קשר",purchase:"רכישה",loading:"טוען...",error:"שגיאה",close:"סגור",back:"חזרה",next:"הבא",previous:"הקודם",readMore:"קרא עוד",viewDetails:"פרטים נוספים",moreDetails:"פרטים נוספים",featuredBook:"ספר מומלץ",allBooks:"כל הספרים",noBooksAvailable:"אין ספרים זמינים כרגע",comingSoon:"בקרוב",newRelease:"חדש",author:"מחבר",pages:"עמודים",price:"מחיר",tableOfContents:"תוכן עניינים",chapter:"פרק",buyNow:"קנה עכשיו",backToCatalog:"חזרה לקטלוג",chapterNavigation:"ניווט פרקים",previousChapter:"פרק קודם",nextChapter:"פרק הבא",backToBook:"חזרה לספר",status:{online:"חזרת למצב מקוון",offline:"אתה במצב לא מקוון - תוכן שמור זמין",loading:"טוען...",error:"אירעה שגיאה"},errors:{general:"אירעה שגיאה. אנא נסה שוב.",bookNotFound:"הספר לא נמצא",chapterNotFound:"הפרק לא נמצא",networkError:"שגיאת רשת. בדוק את החיבור שלך.",loadFailed:"הטעינה נכשלה"},a11y:{skipToMain:"דלג לתוכן הראשי",openMenu:"פתח תפריט",closeMenu:"סגור תפריט",changeLanguage:"שנה שפה",loading:"טוען תוכן",imageAlt:"תמונה של {title}"},currency:{ils:"₪",eur:"€",usd:"$"}},fr:{home:"Accueil",books:"Livres",about:"À propos",contact:"Contact",purchase:"Achat",loading:"Chargement...",error:"Erreur",close:"Fermer",back:"Retour",next:"Suivant",previous:"Précédent",readMore:"Lire la suite",viewDetails:"Voir les détails",moreDetails:"Plus de détails",featuredBook:"Livre en vedette",allBooks:"Tous les livres",noBooksAvailable:"Aucun livre disponible actuellement",comingSoon:"Bientôt disponible",newRelease:"Nouveau",author:"Auteur",pages:"Pages",price:"Prix",tableOfContents:"Table des matières",chapter:"Chapitre",buyNow:"Acheter",backToCatalog:"Retour au catalogue",chapterNavigation:"Navigation",previousChapter:"Chapitre précédent",nextChapter:"Chapitre suivant",backToBook:"Retour au livre",status:{online:"Vous êtes de nouveau en ligne",offline:"Vous êtes hors ligne - contenu sauvegardé disponible",loading:"Chargement...",error:"Une erreur s'est produite"},errors:{general:"Une erreur s'est produite. Veuillez réessayer.",bookNotFound:"Livre non trouvé",chapterNotFound:"Chapitre non trouvé",networkError:"Erreur réseau. Vérifiez votre connexion.",loadFailed:"Le chargement a échoué"},a11y:{skipToMain:"Passer au contenu principal",openMenu:"Ouvrir le menu",closeMenu:"Fermer le menu",changeLanguage:"Changer de langue",loading:"Chargement du contenu",imageAlt:"Image de {title}"},currency:{ils:"₪",eur:"€",usd:"$"}}}}setLanguage(e){this.translations[e]?this.currentLanguage=e:(console.warn(`Language '${e}' not supported, falling back to 'he'`),this.currentLanguage="he")}t(e,t={}){const r=e.split(".");let a=this.translations[this.currentLanguage];for(const o of r){if(!a||"object"!=typeof a||!(o in a))return console.warn(`Translation key '${e}' not found for language '${this.currentLanguage}'`),e;a=a[o]}return"string"==typeof a?this.interpolate(a,t):(console.warn(`Translation key '${e}' is not a string`),e)}interpolate(e,t){return e.replace(/\{(\w+)\}/g,(e,r)=>t.hasOwnProperty(r)?t[r]:e)}getLanguage(){return this.currentLanguage}isRTL(e=this.currentLanguage){return"he"===e||"ar"===e}getDirection(e=this.currentLanguage){return this.isRTL(e)?"rtl":"ltr"}getAvailableLanguages(){return Object.keys(this.translations)}addTranslations(e,t){this.translations[e]||(this.translations[e]={}),this.translations[e]={...this.translations[e],...t}}};const a=new class{constructor(){this.state={books:[],currentLanguage:"he",isLoading:!0,error:null,isOnline:navigator.onLine},this.services={books:new e,storage:new t},this.components=new Map}async init(){try{console.log("Initializing Geoulah Books application...");const e=this.detectLanguage();this.setLanguage(e),this.setupEventListeners(),await this.loadData(),this.initComponents(),this.setState({isLoading:!1}),console.log("Application initialized successfully")}catch(e){console.error("Application initialization error:",e),this.handleError(e)}}detectLanguage(){const e=new URLSearchParams(window.location.search).get("lang");if(e&&["he","fr"].includes(e))return e;const t=this.services.storage.get("preferredLanguage");if(t&&["he","fr"].includes(t))return t;return"fr"===navigator.language.split("-")[0]?"fr":"he"}setLanguage(e){["he","fr"].includes(e)||(console.warn(`Invalid language: ${e}, defaulting to 'he'`),e="he"),this.state.currentLanguage=e,this.services.storage.set("preferredLanguage",e),document.documentElement.setAttribute("lang",e),document.documentElement.setAttribute("dir","he"===e?"rtl":"ltr"),r.setLanguage(e),this.updatePageTitle(),this.emit("languageChange",{language:e}),console.log(`Language set to: ${e}`)}updatePageTitle(){const e=document.querySelector("title");if(e){const t="he"===this.state.currentLanguage?"ספרי גאולה - Geoulah Books":"Geoulah Books - ספרי גאולה";e.textContent=t}}initComponents(){console.log("Ready to initialize components")}registerComponent(e,t){this.components.set(e,t),console.log(`Component registered: ${e}`)}getComponent(e){return this.components.get(e)}async loadData(){try{this.setState({isLoading:!0});const e=await this.services.books.getAll();this.setState({books:e,isLoading:!1,error:null}),console.log(`Loaded ${e.length} books`)}catch(e){throw console.error("Error loading data:",e),this.setState({error:e.message,isLoading:!1}),e}}setupEventListeners(){window.addEventListener("online",()=>this.handleOnlineStatus(!0)),window.addEventListener("offline",()=>this.handleOnlineStatus(!1)),document.addEventListener("visibilitychange",()=>{document.hidden?this.onPageHidden():this.onPageVisible()}),window.addEventListener("error",e=>{console.error("Global error:",e.error)}),window.addEventListener("unhandledrejection",e=>{console.error("Unhandled promise rejection:",e.reason)})}setState(e){const t={...this.state};this.state={...this.state,...e},this.emit("stateChange",{newState:this.state,oldState:t,changes:e})}getState(){return{...this.state}}emit(e,t){const r=new CustomEvent(`app:${e}`,{detail:t,bubbles:!0});document.dispatchEvent(r)}on(e,t){const r=`app:${e}`;return document.addEventListener(r,t),()=>document.removeEventListener(r,t)}async registerServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/sw.js");console.log("Service Worker registered:",e.scope)}catch(e){console.error("Service Worker registration failed:",e)}}handleError(e){console.error("Application error:",e),this.setState({error:e.message}),this.showNotification(r.t("errors.general"),"error")}handleOnlineStatus(e){this.setState({isOnline:e});const t=e?r.t("status.online"):r.t("status.offline");this.showNotification(t,e?"success":"warning"),console.log("Network status: "+(e?"online":"offline"))}showNotification(e,t="info",r=3e3){console.log(`[${t.toUpperCase()}] ${e}`),this.emit("notification",{message:e,type:t,duration:r})}onPageHidden(){console.log("Page hidden")}onPageVisible(){console.log("Page visible")}async getBook(e){return this.services.books.getBySlug(e)}getBooks(){return this.state.books}async reload(){this.services.books.clearCache(),await this.loadData()}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>a.init()):a.init();class o{constructor(e,t){this.element=e,this.app=t,this.mobileMenuToggle=e.querySelector(".mobile-menu-toggle"),this.mainNav=e.querySelector(".main-nav"),this.langButtons=e.querySelectorAll(".lang-btn"),this.init()}init(){this.setupMobileMenu(),this.setupLanguageSwitcher(),this.setupEventListeners()}setupMobileMenu(){if(!this.mobileMenuToggle||!this.mainNav)return;this.mobileMenuToggle.addEventListener("click",()=>{const e="true"===this.mobileMenuToggle.getAttribute("aria-expanded");this.mobileMenuToggle.setAttribute("aria-expanded",!e),this.mainNav.classList.toggle("active")}),document.addEventListener("click",e=>{!this.element.contains(e.target)&&this.mainNav.classList.contains("active")&&(this.mobileMenuToggle.setAttribute("aria-expanded","false"),this.mainNav.classList.remove("active"))});this.mainNav.querySelectorAll("a").forEach(e=>{e.addEventListener("click",()=>{this.mobileMenuToggle.setAttribute("aria-expanded","false"),this.mainNav.classList.remove("active")})})}setupLanguageSwitcher(){this.langButtons.length&&this.langButtons.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.lang;this.switchLanguage(t)})})}switchLanguage(e){this.app.setLanguage(e),this.langButtons.forEach(t=>{const r=t.dataset.lang===e;t.classList.toggle("active",r),t.setAttribute("aria-pressed",r)}),this.updateNavLabels()}updateNavLabels(){this.mainNav.querySelectorAll("a").forEach(e=>{const t=e.getAttribute("href");"/"===t||"/index.html"===t?e.textContent=r.t("home"):"#books"===t?e.textContent=r.t("books"):"/about.html"===t||t.includes("about")?e.textContent=r.t("about"):("/contact.html"===t||t.includes("contact"))&&(e.textContent=r.t("contact"))})}setupEventListeners(){document.addEventListener("app:languageChange",()=>{this.updateNavLabels()})}}export{o as H,a,r as i};
