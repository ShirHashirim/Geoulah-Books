(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();src/js/services/book-service.js;class u{constructor(){this.baseUrl="/Geoulah-Books/data",this.cache=new Map}async getAll(){return(await(await fetch(`${this.baseUrl}/books.json`)).json()).books||[]}async getById(e){return(await this.getAll()).find(r=>r.id===e||r.slug===e)}async getChapterContent(e){const t=`/Geoulah-Books/${e}`,r=await fetch(t);if(!r.ok)throw new Error(`Failed to load ${t}`);return await r.text()}getChapter(e,t){var r;return(r=e==null?void 0:e.chapters)==null?void 0:r.find(o=>o.slug===t||o.id===t)}getNextChapter(e,t){var o;const r=(o=e==null?void 0:e.chapters)==null?void 0:o.findIndex(s=>s.slug===t||s.id===t);return r>=0&&r<e.chapters.length-1?e.chapters[r+1]:null}getPreviousChapter(e,t){var o;const r=(o=e==null?void 0:e.chapters)==null?void 0:o.findIndex(s=>s.slug===t||s.id===t);return r>0?e.chapters[r-1]:null}}class c{constructor(e="geoulah_"){this.prefix=e,this.isAvailable=this.checkAvailability()}checkAvailability(){try{const e="__localStorage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return console.warn("localStorage is not available:",e),!1}}getKey(e){return`${this.prefix}${e}`}get(e,t=null){if(!this.isAvailable)return t;try{const r=localStorage.getItem(this.getKey(e));return r===null?t:JSON.parse(r)}catch(r){return console.error(`Error reading from localStorage (key: ${e}):`,r),t}}set(e,t){if(!this.isAvailable)return!1;try{const r=JSON.stringify(t);return localStorage.setItem(this.getKey(e),r),!0}catch(r){return console.error(`Error writing to localStorage (key: ${e}):`,r),!1}}remove(e){if(!this.isAvailable)return!1;try{return localStorage.removeItem(this.getKey(e)),!0}catch(t){return console.error(`Error removing from localStorage (key: ${e}):`,t),!1}}clear(){if(!this.isAvailable)return!1;try{return Object.keys(localStorage).filter(r=>r.startsWith(this.prefix)).forEach(r=>localStorage.removeItem(r)),!0}catch(e){return console.error("Error clearing localStorage:",e),!1}}has(e){return this.isAvailable?localStorage.getItem(this.getKey(e))!==null:!1}keys(){if(!this.isAvailable)return[];try{return Object.keys(localStorage).filter(t=>t.startsWith(this.prefix)).map(t=>t.substring(this.prefix.length))}catch(e){return console.error("Error getting localStorage keys:",e),[]}}getSize(){if(!this.isAvailable)return 0;try{const e=Object.keys(localStorage);let t=0;return e.forEach(r=>{if(r.startsWith(this.prefix)){const o=localStorage.getItem(r);t+=r.length+(o?o.length:0)}}),t}catch(e){return console.error("Error calculating localStorage size:",e),0}}}new c;class g{constructor(){this.currentLanguage="he",this.translations={he:{home:"×‘×™×ª",books:"×¡×¤×¨×™×",about:"××•×“×•×ª",contact:"×¦×•×¨ ×§×©×¨",purchase:"×¨×›×™×©×”",loading:"×˜×•×¢×Ÿ...",error:"×©×’×™××”",close:"×¡×’×•×¨",back:"×—×–×¨×”",next:"×”×‘×",previous:"×”×§×•×“×",readMore:"×§×¨× ×¢×•×“",viewDetails:"×¤×¨×˜×™× × ×•×¡×¤×™×",moreDetails:"×¤×¨×˜×™× × ×•×¡×¤×™×",featuredBook:"×¡×¤×¨ ×ž×•×ž×œ×¥",allBooks:"×›×œ ×”×¡×¤×¨×™×",noBooksAvailable:"××™×Ÿ ×¡×¤×¨×™× ×–×ž×™× ×™× ×›×¨×’×¢",comingSoon:"×‘×§×¨×•×‘",newRelease:"×—×“×©",author:"×ž×—×‘×¨",pages:"×¢×ž×•×“×™×",price:"×ž×—×™×¨",tableOfContents:"×ª×•×›×Ÿ ×¢× ×™×™× ×™×",chapter:"×¤×¨×§",buyNow:"×§× ×” ×¢×›×©×™×•",backToCatalog:"×—×–×¨×” ×œ×§×˜×œ×•×’",chapterNavigation:"× ×™×•×•×˜ ×¤×¨×§×™×",previousChapter:"×¤×¨×§ ×§×•×“×",nextChapter:"×¤×¨×§ ×”×‘×",backToBook:"×—×–×¨×” ×œ×¡×¤×¨",status:{online:"×—×–×¨×ª ×œ×ž×¦×‘ ×ž×§×•×•×Ÿ",offline:"××ª×” ×‘×ž×¦×‘ ×œ× ×ž×§×•×•×Ÿ - ×ª×•×›×Ÿ ×©×ž×•×¨ ×–×ž×™×Ÿ",loading:"×˜×•×¢×Ÿ...",error:"××™×¨×¢×” ×©×’×™××”"},errors:{general:"××™×¨×¢×” ×©×’×™××”. ×× × × ×¡×” ×©×•×‘.",bookNotFound:"×”×¡×¤×¨ ×œ× × ×ž×¦×",chapterNotFound:"×”×¤×¨×§ ×œ× × ×ž×¦×",networkError:"×©×’×™××ª ×¨×©×ª. ×‘×“×•×§ ××ª ×”×—×™×‘×•×¨ ×©×œ×š.",loadFailed:"×”×˜×¢×™× ×” × ×›×©×œ×”"},a11y:{skipToMain:"×“×œ×’ ×œ×ª×•×›×Ÿ ×”×¨××©×™",openMenu:"×¤×ª×— ×ª×¤×¨×™×˜",closeMenu:"×¡×’×•×¨ ×ª×¤×¨×™×˜",changeLanguage:"×©× ×” ×©×¤×”",loading:"×˜×•×¢×Ÿ ×ª×•×›×Ÿ",imageAlt:"×ª×ž×•× ×” ×©×œ {title}"},currency:{ils:"â‚ª",eur:"â‚¬",usd:"$"}},fr:{home:"Accueil",books:"Livres",about:"Ã€ propos",contact:"Contact",purchase:"Achat",loading:"Chargement...",error:"Erreur",close:"Fermer",back:"Retour",next:"Suivant",previous:"PrÃ©cÃ©dent",readMore:"Lire la suite",viewDetails:"Voir les dÃ©tails",moreDetails:"Plus de dÃ©tails",featuredBook:"Livre en vedette",allBooks:"Tous les livres",noBooksAvailable:"Aucun livre disponible actuellement",comingSoon:"BientÃ´t disponible",newRelease:"Nouveau",author:"Auteur",pages:"Pages",price:"Prix",tableOfContents:"Table des matiÃ¨res",chapter:"Chapitre",buyNow:"Acheter",backToCatalog:"Retour au catalogue",chapterNavigation:"Navigation",previousChapter:"Chapitre prÃ©cÃ©dent",nextChapter:"Chapitre suivant",backToBook:"Retour au livre",status:{online:"Vous Ãªtes de nouveau en ligne",offline:"Vous Ãªtes hors ligne - contenu sauvegardÃ© disponible",loading:"Chargement...",error:"Une erreur s'est produite"},errors:{general:"Une erreur s'est produite. Veuillez rÃ©essayer.",bookNotFound:"Livre non trouvÃ©",chapterNotFound:"Chapitre non trouvÃ©",networkError:"Erreur rÃ©seau. VÃ©rifiez votre connexion.",loadFailed:"Le chargement a Ã©chouÃ©"},a11y:{skipToMain:"Passer au contenu principal",openMenu:"Ouvrir le menu",closeMenu:"Fermer le menu",changeLanguage:"Changer de langue",loading:"Chargement du contenu",imageAlt:"Image de {title}"},currency:{ils:"â‚ª",eur:"â‚¬",usd:"$"}}}}setLanguage(e){this.translations[e]?this.currentLanguage=e:(console.warn(`Language '${e}' not supported, falling back to 'he'`),this.currentLanguage="he")}t(e,t={}){const r=e.split(".");let o=this.translations[this.currentLanguage];for(const s of r)if(o&&typeof o=="object"&&s in o)o=o[s];else return console.warn(`Translation key '${e}' not found for language '${this.currentLanguage}'`),e;return typeof o=="string"?this.interpolate(o,t):(console.warn(`Translation key '${e}' is not a string`),e)}interpolate(e,t){return e.replace(/\{(\w+)\}/g,(r,o)=>t.hasOwnProperty(o)?t[o]:r)}getLanguage(){return this.currentLanguage}isRTL(e=this.currentLanguage){return e==="he"||e==="ar"}getDirection(e=this.currentLanguage){return this.isRTL(e)?"rtl":"ltr"}getAvailableLanguages(){return Object.keys(this.translations)}addTranslations(e,t){this.translations[e]||(this.translations[e]={}),this.translations[e]={...this.translations[e],...t}}}const a=new g;class h{constructor(){this.state={books:[],currentLanguage:"he",isLoading:!0,error:null,isOnline:navigator.onLine},this.services={books:new u,storage:new c},this.components=new Map}async init(){try{console.log("Initializing Geoulah Books application...");const e=this.detectLanguage();this.setLanguage(e),this.setupEventListeners(),await this.loadData(),this.initComponents(),this.setState({isLoading:!1}),console.log("Application initialized successfully")}catch(e){console.error("Application initialization error:",e),this.handleError(e)}}detectLanguage(){const t=new URLSearchParams(window.location.search).get("lang");if(t&&["he","fr"].includes(t))return t;const r=this.services.storage.get("preferredLanguage");return r&&["he","fr"].includes(r)?r:navigator.language.split("-")[0]==="fr"?"fr":"he"}setLanguage(e){["he","fr"].includes(e)||(console.warn(`Invalid language: ${e}, defaulting to 'he'`),e="he"),this.state.currentLanguage=e,this.services.storage.set("preferredLanguage",e),document.documentElement.setAttribute("lang",e),document.documentElement.setAttribute("dir",e==="he"?"rtl":"ltr"),a.setLanguage(e),this.updatePageTitle(),this.emit("languageChange",{language:e}),console.log(`Language set to: ${e}`)}updatePageTitle(){const e=document.querySelector("title");if(e){const r=this.state.currentLanguage==="he"?"×¡×¤×¨×™ ×’××•×œ×” - Geoulah Books":"Geoulah Books - ×¡×¤×¨×™ ×’××•×œ×”";e.textContent=r}}initComponents(){console.log("Ready to initialize components")}registerComponent(e,t){this.components.set(e,t),console.log(`Component registered: ${e}`)}getComponent(e){return this.components.get(e)}async loadData(){try{this.setState({isLoading:!0});const e=await this.services.books.getAll();this.setState({books:e,isLoading:!1,error:null}),console.log(`Loaded ${e.length} books`)}catch(e){throw console.error("Error loading data:",e),this.setState({error:e.message,isLoading:!1}),e}}setupEventListeners(){window.addEventListener("online",()=>this.handleOnlineStatus(!0)),window.addEventListener("offline",()=>this.handleOnlineStatus(!1)),document.addEventListener("visibilitychange",()=>{document.hidden?this.onPageHidden():this.onPageVisible()}),window.addEventListener("error",e=>{console.error("Global error:",e.error)}),window.addEventListener("unhandledrejection",e=>{console.error("Unhandled promise rejection:",e.reason)})}setState(e){const t={...this.state};this.state={...this.state,...e},this.emit("stateChange",{newState:this.state,oldState:t,changes:e})}getState(){return{...this.state}}emit(e,t){const r=new CustomEvent(`app:${e}`,{detail:t,bubbles:!0});document.dispatchEvent(r)}on(e,t){const r=`app:${e}`;return document.addEventListener(r,t),()=>document.removeEventListener(r,t)}async registerServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/sw.js");console.log("Service Worker registered:",e.scope)}catch(e){console.error("Service Worker registration failed:",e)}}handleError(e){console.error("Application error:",e),this.setState({error:e.message}),this.showNotification(a.t("errors.general"),"error")}handleOnlineStatus(e){this.setState({isOnline:e});const t=e?a.t("status.online"):a.t("status.offline");this.showNotification(t,e?"success":"warning"),console.log(`Network status: ${e?"online":"offline"}`)}showNotification(e,t="info",r=3e3){console.log(`[${t.toUpperCase()}] ${e}`),this.emit("notification",{message:e,type:t,duration:r})}onPageHidden(){console.log("Page hidden")}onPageVisible(){console.log("Page visible")}async getBook(e){return this.services.books.getBySlug(e)}getBooks(){return this.state.books}async reload(){this.services.books.clearCache(),await this.loadData()}}const l=new h;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>l.init()):l.init();class d{constructor(e,t){this.element=e,this.app=t,this.render()}render(){const e=this.app.getState().currentLanguage;this.element.innerHTML=`
      <div class="header-content">
        <a href="index.html" class="logo">
          <span class="logo-icon">ðŸ“š</span>
          <span class="logo-text">Geoulah Books</span>
        </a>
        
        <nav>
          <button id="lang-toggle" class="btn-text">
            ${e==="he"?"FranÃ§ais":"×¢×‘×¨×™×ª"}
          </button>
        </nav>
      </div>
    `,this.element.querySelector("#lang-toggle").addEventListener("click",()=>{const t=e==="he"?"fr":"he";this.app.setState({currentLanguage:t})})}}export{d as H,l as a,a as i};
