import{H as v,a as o}from"./header-DMeG9USy.js";const u=document.querySelector(".site-header");u&&new v(u,o);const g=new URLSearchParams(window.location.search),f=g.get("book"),m=g.get("chapter");f&&m&&y(f,m);async function y(t,s){try{const r=await o.getBook(t),n=o.services.books.getChapter(r,s);if(!n)throw new Error("Chapter not found");const a=o.getState().currentLanguage;document.title=`${n.title[a]} - ${r.title[a]}`,await w(r,n,a),b(r,n,a)}catch(r){console.error(r),document.getElementById("chapter-content").innerHTML='<p class="error">Error loading chapter.</p>'}}async function w(t,s,r){const n=document.getElementById("chapter-content");let a=await o.services.books.getChapterContent(s.contentFile);const l=new DOMParser().parseFromString(a,"text/html");l.querySelectorAll("img").forEach(c=>{const e=c.getAttribute("src");e&&!e.startsWith("http")&&!e.startsWith("/")&&c.setAttribute("src",`content/${t.id}/${e}`)}),l.querySelectorAll("a").forEach(c=>{const e=c.getAttribute("href");if(e&&!e.startsWith("http")&&!e.startsWith("#")&&e.endsWith(".html")){const i=e.replace(".html","");i==="index"?c.setAttribute("href",`book.html?id=${t.id}`):c.setAttribute("href",`chapter.html?book=${t.id}&chapter=${i}`)}}),l.querySelectorAll('link[rel="stylesheet"]').forEach(c=>{const e=c.getAttribute("href");if(e&&!e.startsWith("http")){const i=`content/${t.id}/${e}`;if(!document.querySelector(`link[href="${i}"]`)){const d=document.createElement("link");d.rel="stylesheet",d.href=i,document.head.appendChild(d)}}});let $=l.body.innerHTML;const p=document.createElement("div");p.innerHTML=$,p.querySelectorAll("#header, #menus, #fleches").forEach(c=>c.remove()),n.innerHTML=`
    <article class="chapter-reader">
      <h1>${s.title[r]}</h1>
      <div class="chapter-text">${p.innerHTML}</div>
    </article>
  `}function b(t,s,r){const n=o.services.books.getPreviousChapter(t,s.slug),a=o.services.books.getNextChapter(t,s.slug),h=document.querySelector(".chapter-navigation");h&&(h.innerHTML=`
      ${n?`<a href="chapter.html?book=${t.id}&chapter=${n.slug}" class="nav-prev">← ${n.title[r]}</a>`:"<span></span>"}
      <a href="book.html?id=${t.id}" class="nav-up">Top</a>
      ${a?`<a href="chapter.html?book=${t.id}&chapter=${a.slug}" class="nav-next">${a.title[r]} →</a>`:"<span></span>"}
    `)}
