import{H as e,a as t,i as n}from"./header-BTcOR6oH.js";const a=document.querySelector(".site-header");a&&new e(a,t);const r=new URLSearchParams(window.location.search),o=r.get("book"),c=r.get("chapter");function s(e,t,n){const a=document.getElementById("breadcrumb-book"),r=document.getElementById("breadcrumb-chapter");a&&(a.textContent=e.title[n],a.href=`/book.html?id=${e.slug}`),r&&(r.textContent=t.title[n])}async function i(e,a,r){const o=document.getElementById("chapter-content");if(o)try{o.innerHTML=`\n      <div class="loading" role="status" aria-live="polite">\n        <span class="spinner" aria-hidden="true"></span>\n        <span>${n.t("loading")}</span>\n      </div>\n    `;let c=await t.services.books.getChapterContent(a.contentFile);const s=document.createElement("div");s.innerHTML=c;let i=s.querySelector(".chapter-content")||s.querySelector("#contenu")||s.querySelector("article")||s.querySelector("main")||s;i.querySelectorAll("script").forEach(e=>e.remove());i.querySelectorAll("#fleches, #entete, .nav").forEach(e=>e.remove()),c=i.innerHTML;const l=t.services.books.getPreviousChapter(e,a.slug),p=t.services.books.getNextChapter(e,a.slug);o.innerHTML=`\n      <div class="chapter-container">\n        <header class="chapter-header">\n          <h1 class="chapter-title">${h(a.title[r])}</h1>\n          <p class="chapter-meta">${h(e.title[r])} - ${h(e.author)}</p>\n        </header>\n\n        <article class="chapter-content">\n          ${c}\n        </article>\n\n        <nav class="chapter-navigation" aria-label="${n.t("chapterNavigation")}">\n          ${l?`\n            <a href="/chapter.html?book=${e.slug}&chapter=${l.slug}" class="nav-btn nav-btn-prev">\n              <span aria-hidden="true">${"he"===r?"→":"←"}</span>\n              <span>${n.t("previousChapter")}</span>\n            </a>\n          `:"<div></div>"}\n\n          <a href="/book.html?id=${e.slug}" class="nav-btn nav-btn-toc">\n            ${n.t("tableOfContents")}\n          </a>\n\n          ${p?`\n            <a href="/chapter.html?book=${e.slug}&chapter=${p.slug}" class="nav-btn nav-btn-next">\n              <span>${n.t("nextChapter")}</span>\n              <span aria-hidden="true">${"he"===r?"←":"→"}</span>\n            </a>\n          `:"<div></div>"}\n        </nav>\n      </div>\n    `}catch(c){console.error("Error rendering chapter:",c),o.innerHTML=`\n      <div style="text-align: center; padding: var(--space-3xl); color: var(--color-error);">\n        <h2>${n.t("errors.loadFailed")}</h2>\n        <p style="margin-top: var(--space-md);">\n          <a href="/book.html?id=${e.slug}" class="btn-primary">${n.t("backToBook")}</a>\n        </p>\n      </div>\n    `}}function l(e){const t=document.getElementById("chapter-content");t&&(t.innerHTML=`\n      <div style="text-align: center; padding: var(--space-3xl); color: var(--color-error);">\n        <h2>${e}</h2>\n        <p style="margin-top: var(--space-md);">\n          <a href="/" class="btn-primary">${n.t("home")}</a>\n        </p>\n      </div>\n    `)}function h(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}o&&c?async function(e,a){try{const n=await t.getBook(e),r=t.services.books.getChapter(n,a);if(!r)throw new Error("Chapter not found");const o=t.getState().currentLanguage;document.title=`${r.title[o]} - ${n.title[o]} - ספרי גאולה`,s(n,r,o),await i(n,r,o),document.addEventListener("app:languageChange",async()=>{const e=t.getState().currentLanguage;document.title=`${r.title[e]} - ${n.title[e]} - ספרי גאולה`,s(n,r,e),await i(n,r,e)})}catch(r){console.error("Error loading chapter:",r),l(n.t("errors.chapterNotFound"))}}(o,c):l("לא צוינו פרמטרים נדרשים");
